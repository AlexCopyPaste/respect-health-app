<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>חיים רק פעם אחת</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --main-bg: #f8f9fa;
            --error-red: #ffcccc;
        }

        body {
            background-color: var(--main-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background 0.3s ease;
        }

        /* Dashboard Layout - Static */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 10px;
        }

        .metric-card {
            background: white;
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .metric-card:active { transform: scale(0.95); }
        .metric-card i { font-size: 3rem; margin-bottom: 10px; }

        /* Dynamic Pages */
        .page-header {
            padding: 30px 20px;
            border-radius: 0 0 30px 30px;
            color: white;
            margin-bottom: 25px;
            text-align: center;
        }

        /* Strict Validation */
        .is-invalid-custom {
            background-color: var(--error-red) !important;
            border: 2px solid red !important;
        }

        /* History Items */
        .history-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 10px;
            padding: 15px;
            border-right: 6px solid;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }

        .month-divider {
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 10px;
            margin: 25px 0 12px;
            font-weight: bold;
            color: #495057;
        }

        /* Floating WhatsApp */
        .whatsapp-btn {
            position: fixed;
            bottom: 25px;
            left: 25px;
            background: #25d366;
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.25);
            z-index: 1000;
            text-decoration: none;
        }

        .btn-huge { padding: 18px; font-size: 1.3rem; border-radius: 15px; width: 100%; }
        
        .app-page { display: none; }
        .app-page.active { display: block; }
    </style>
</head>
<body>

<div id="home-page" class="app-page active">
    <div class="container py-4">
        <header class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h2 fw-bold m-0 text-primary">חיים רק פעם אחת</h1>
            <button class="btn btn-light rounded-circle shadow-sm" onclick="showPage('info-page')">
                <i class="fas fa-info-circle text-primary fs-3"></i>
            </button>
        </header>

        <div class="dashboard-grid">
            <div class="metric-card" style="border-color: #dc354520" onclick="openMetric('bp')">
                <i class="fas fa-heart-pulse text-danger"></i>
                <div class="fw-bold">לחץ דם</div>
            </div>
            <div class="metric-card" style="border-color: #fd7e1420" onclick="openMetric('sugar')">
                <i class="fas fa-droplet" style="color: #fd7e14"></i>
                <div class="fw-bold">סוכר</div>
            </div>
            <div class="metric-card" style="border-color: #19875420" onclick="openMetric('pills')">
                <i class="fas fa-pills text-success"></i>
                <div class="fw-bold">תרופות</div>
            </div>
            <div class="metric-card" style="border-color: #0dcaf020" onclick="openMetric('weight')">
                <i class="fas fa-weight-scale text-info"></i>
                <div class="fw-bold">משקל</div>
            </div>
            <div class="metric-card" style="border-color: #0d6efd20" onclick="openMetric('walk')">
                <i class="fas fa-person-walking text-primary"></i>
                <div class="fw-bold">הליכה</div>
            </div>
            <div class="metric-card" style="border-color: #6f42c120" onclick="openMetric('gym')">
                <i class="fas fa-dumbbell" style="color: #6f42c1"></i>
                <div class="fw-bold">כושר</div>
            </div>
        </div>

        <div class="mt-5 d-grid gap-3">
            <button class="btn btn-outline-dark btn-huge" onclick="exportData()">
                <i class="fas fa-file-csv me-2"></i> ייצוא דוח לרופא
            </button>
            <button class="btn btn-link text-danger" onclick="clearAll()">מחיקת כל המידע</button>
        </div>
    </div>
</div>

<div id="metric-page" class="app-page">
    <div id="metric-header" class="page-header">
        <button class="btn btn-link text-white float-start" onclick="showPage('home-page')">
            <i class="fas fa-chevron-right fs-3"></i>
        </button>
        <i id="header-icon" class="fas mb-2"></i>
        <h2 id="header-title" class="m-0 fw-bold"></h2>
    </div>

    <div class="container">
        <div class="card shadow-sm border-0 rounded-4 p-4 mb-4">
            <form id="data-form">
                <div class="mb-3">
                    <label class="form-label fw-bold">תאריך ושעה</label>
                    <input type="datetime-local" id="f-date" class="form-control form-control-lg">
                </div>
                <div class="row g-3" id="dynamic-inputs"></div>
                <button type="button" class="btn btn-primary btn-huge mt-4 shadow" onclick="saveData()">שמור מדידה</button>
            </form>
        </div>

        <h4 class="mb-3 mt-4 fw-bold">היסטוריה</h4>
        <div id="history-list"></div>
    </div>
</div>

<div id="info-page" class="app-page">
    <div class="container py-5 text-center">
        <i class="fas fa-user-shield text-primary mb-4" style="font-size: 5rem;"></i>
        <h2>המידע שלך נשאר שלך</h2>
        <p class="fs-5 mt-3">אלכס, חשוב שתדע: האפליקציה שומרת את הנתונים <strong>רק על המכשיר שלך</strong>. אין שרת, אין מעקב, הפרטיות שלך מלאה.</p>
        <button class="btn btn-primary btn-huge mt-4" onclick="showPage('home-page')">חזרה לעמוד הראשי</button>
    </div>
</div>

<a id="wa-link" href="#" target="_blank" class="whatsapp-btn shadow">
    <i class="fab fa-whatsapp"></i>
</a>

<script>
/**
 * CONFIGURATION & DATA LOGIC
 */
const CONFIG = {
    bp: { name: 'לחץ דם ודופק', icon: 'fa-heart-pulse', color: '#dc3545', fields: [
        { id: 'sys', label: 'סיסטולי', min: 70, max: 220, unit: 'mmHg' },
        { id: 'dia', label: 'דיאסטולי', min: 40, max: 130, unit: 'mmHg' },
        { id: 'pulse', label: 'דופק', min: 30, max: 200, unit: 'bpm' }
    ]},
    sugar: { name: 'סוכר', icon: 'fa-droplet', color: '#fd7e14', fields: [
        { id: 'val', label: 'רמת סוכר', min: 20, max: 600, unit: 'mg/dL' }
    ]},
    weight: { name: 'משקל', icon: 'fa-weight-scale', color: '#0dcaf0', fields: [
        { id: 'val', label: 'משקל', min: 30, max: 250, unit: 'kg' }
    ]},
    walk: { name: 'הליכה / ריצה', icon: 'fa-person-walking', color: '#0d6efd', fields: [
        { id: 'val', label: 'מרחק', min: 0, max: 100, unit: 'km' }
    ]},
    gym: { name: 'חדר כושר', icon: 'fa-dumbbell', color: '#6f42c1', fields: [
        { id: 'val', label: 'זמן', min: 0, max: 500, unit: 'min' }
    ]},
    pills: { name: 'תרופות', icon: 'fa-pills', color: '#198754', type: 'meds' }
};

let activeId = null;
const MY_PHONE = "972500000000"; // <--- CHANGE TO YOUR PHONE NUMBER

document.addEventListener('DOMContentLoaded', () => {
    const text = encodeURIComponent("היי, אני נהנה מאפליקציה שלך ויש לי המלצה שכדי לשנות בתוכנה שלך:");
    document.getElementById('wa-link').href = `https://wa.me/${MY_PHONE}?text=${text}`;
});

function showPage(id) {
    document.querySelectorAll('.app-page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0,0);
}

function openMetric(id) {
    activeId = id;
    const c = CONFIG[id];
    document.getElementById('header-title').innerText = c.name;
    document.getElementById('header-icon').className = `fas ${c.icon} mb-2`;
    document.getElementById('metric-header').style.backgroundColor = c.color;
    document.body.style.backgroundColor = `${c.color}08`;
    
    // Set Date
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('f-date').value = now.toISOString().slice(0, 16);
    
    renderInputs(c);
    renderHistory();
    showPage('metric-page');
}

function renderInputs(c) {
    const div = document.getElementById('dynamic-inputs');
    div.innerHTML = '';
    if (c.type === 'meds') {
        div.innerHTML = `
            <div class="col-12"><label class="form-label fw-bold">שם התרופה</label><input type="text" id="f-med" class="form-control form-control-lg"></div>
            <div class="col-6"><label class="form-label fw-bold">מינון (מ"ג)</label><input type="number" id="f-mg" class="form-control form-control-lg"></div>
            <div class="col-6"><label class="form-label fw-bold">זמן</label><select id="f-time" class="form-select form-select-lg"><option>בוקר</option><option>צהריים</option><option>ערב</option></select></div>
        `;
    } else {
        c.fields.forEach(f => {
            div.innerHTML += `
                <div class="col-12">
                    <label class="form-label fw-bold">${f.label} (${f.unit})</label>
                    <input type="number" id="f-${f.id}" class="form-control form-control-lg v-field" data-min="${f.min}" data-max="${f.max}" oninput="valField(this)">
                </div>
            `;
        });
    }
}

function valField(el) {
    const v = parseFloat(el.value);
    const min = parseFloat(el.dataset.min);
    const max = parseFloat(el.dataset.max);
    const ok = !isNaN(v) && v >= min && v <= max;
    el.classList.toggle('is-invalid-custom', el.value !== "" && !ok);
    return ok;
}

function saveData() {
    const c = CONFIG[activeId];
    let entry = { id: Date.now(), date: document.getElementById('f-date').value, mid: activeId };
    let valid = true;

    if (c.type === 'meds') {
        entry.med = document.getElementById('f-med').value;
        entry.mg = document.getElementById('f-mg').value;
        entry.time = document.getElementById('f-time').value;
        if(!entry.med) valid = false;
    } else {
        c.fields.forEach(f => {
            const el = document.getElementById(`f-${f.id}`);
            if (!valField(el) || el.value === "") valid = false;
            entry[f.id] = el.value;
        });
    }

    if (!valid) return alert("אנא הזן נתונים תקינים בשדות האדומים");

    const db = JSON.parse(localStorage.getItem('h_db') || '[]');
    db.unshift(entry);
    localStorage.setItem('h_db', JSON.stringify(db));
    alert("נשמר!");
    renderHistory();
    document.querySelectorAll('input:not([type="datetime-local"])').forEach(i => i.value = "");
}

function renderHistory() {
    const list = document.getElementById('history-list');
    const db = JSON.parse(localStorage.getItem('h_db') || '[]');
    const filtered = db.filter(i => i.mid === activeId);
    
    if (!filtered.length) return list.innerHTML = '<p class="text-muted">אין מדידות.</p>';

    let html = '', lastM = '';
    filtered.forEach(e => {
        const d = new Date(e.date);
        const mKey = d.toLocaleDateString('he-IL', { month: 'long', year: 'numeric' });
        if (mKey !== lastM) { html += `<div class="month-divider">${mKey}</div>`; lastM = mKey; }
        
        let valStr = (activeId === 'pills') ? `${e.med} (${e.mg}מ"ג) - ${e.time}` : 
            CONFIG[activeId].fields.map(f => `${f.label}: ${e[f.id]}`).join(' | ');

        html += `
            <div class="history-card" style="border-right-color: ${CONFIG[activeId].color}">
                <div class="small text-muted">${d.toLocaleDateString('he-IL', {day:'numeric'})} לחודש | ${d.toLocaleTimeString('he-IL',{hour:'2-digit',minute:'2-digit'})}</div>
                <div class="fw-bold">${valStr}</div>
            </div>
        `;
    });
    list.innerHTML = html;
}

function exportData() {
    const db = JSON.parse(localStorage.getItem('h_db') || '[]');
    if (!db.length) return alert("אין נתונים");
    let csv = "\uFEFFתאריך,מדד,נתונים\n";
    db.forEach(e => {
        const c = CONFIG[e.mid];
        let info = (e.mid === 'pills') ? `${e.med} (${e.mg}mg)` : c.fields.map(f => `${f.label}:${e[f.id]}`).join(' ');
        csv += `${e.date},${c.name},"${info}"\n`;
    });
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "דוח_בריאות.csv";
    a.click();
}

function clearAll() {
    if(confirm("למחוק הכל לנצח?")) { localStorage.removeItem('h_db'); location.reload(); }
}
</script>
</body>
</html>  
